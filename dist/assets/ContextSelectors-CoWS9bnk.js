import{j as e,r as t}from"./index-C8jGRvk-.js";import"./react-vendor-CVzL7Oab.js";function v(){const o=t.createContext(null);function s({value:n,children:c}){const u=t.useRef(n),l=t.useRef(new Set);u.current=n;const h=t.useCallback(a=>(l.current.add(a),()=>l.current.delete(a)),[]);t.useEffect(()=>{l.current.forEach(a=>a())},[n]);const p=t.useCallback(()=>u.current,[]),x=t.useMemo(()=>({subscribe:h,getSnapshot:p}),[h,p]);return e.jsx(o.Provider,{value:x,children:c})}function r(n){const c=t.useContext(o);if(!c)throw new Error("useSelector must be within Provider");return t.useSyncExternalStore(c.subscribe,()=>n(c.getSnapshot()))}return{Provider:s,useSelector:r}}function T(){return e.jsxs("div",{children:[e.jsx("h1",{children:"Context Selectors"}),e.jsx("p",{children:"Learn how to optimize Context performance by selecting only the data you need. Prevent unnecessary re-renders with context selectors!"}),e.jsxs("section",{style:{marginBottom:"var(--space-8)"},children:[e.jsx("h2",{children:"The Problem with Context"}),e.jsx("p",{children:"When any part of context changes, ALL consumers re-render, even if they don't use the changed value."}),e.jsxs("div",{style:{background:"var(--color-error)",color:"white",padding:"var(--space-4)",borderRadius:"var(--radius-lg)",marginTop:"var(--space-4)"},children:[e.jsx("h3",{style:{color:"white",marginBottom:"var(--space-3)"},children:"‚ùå Problem:"}),e.jsx("pre",{style:{background:"transparent"},children:e.jsx("code",{style:{color:"white"},children:`const state = { user, theme, settings };

// Component only uses theme
function Component() {
  const { theme } = useContext(AppContext);
  return <div className={theme}>...</div>;
}

// But re-renders when user or settings change!`})})]}),e.jsxs("div",{style:{background:"var(--bg-secondary)",padding:"var(--space-6)",borderRadius:"var(--radius-lg)",marginTop:"var(--space-4)",border:"2px solid var(--color-error)"},children:[e.jsx("h3",{style:{marginBottom:"var(--space-4)",color:"var(--color-error)"},children:"Interactive Problem Demo"}),e.jsx(m,{})]})]}),e.jsxs("section",{style:{marginBottom:"var(--space-8)"},children:[e.jsx("h2",{children:"Solution: Context Selectors"}),e.jsx("p",{children:"Selectors let you subscribe to only the part of context you need."}),e.jsxs("div",{style:{background:"var(--color-success)",color:"white",padding:"var(--space-4)",borderRadius:"var(--radius-lg)",marginTop:"var(--space-4)"},children:[e.jsx("h3",{style:{color:"white",marginBottom:"var(--space-3)"},children:"‚úÖ Solution:"}),e.jsx("pre",{style:{background:"transparent"},children:e.jsx("code",{style:{color:"white"},children:`// Only re-renders when theme changes!
function Component() {
  const theme = useSelector(state => state.theme);
  return <div className={theme}>...</div>;
}`})})]})]}),e.jsxs("section",{style:{marginBottom:"var(--space-8)"},children:[e.jsx("h2",{children:"Implementation with useSyncExternalStore"}),e.jsxs("p",{children:["React 18+ provides ",e.jsx("code",{children:"useSyncExternalStore"})," for building selectors."]}),e.jsx("pre",{style:{background:"transparent"},children:e.jsx("code",{children:`function useContextSelector(context, selector) {
  const value = useContext(context);
  
  return useSyncExternalStore(
    value.subscribe, // React subscribes to changes
    () => selector(value.getSnapshot()) // Selects only the data needed
  );
}`})}),e.jsx("h3",{style:{marginTop:"var(--space-6)",marginBottom:"var(--space-3)"},children:"‚öôÔ∏è How it Works:"}),e.jsxs("p",{children:["We rely on ",e.jsx("code",{children:"useSyncExternalStore"})," which is designed for subscribing to external state."]}),e.jsx("h4",{style:{marginTop:"var(--space-4)"},children:"1. The Store (Provider)"}),e.jsx("pre",{style:{background:"transparent"},children:e.jsx("code",{children:`// We store the state in a ref so updating it doesn't trigger a Provider re-render
const storeRef = useRef(value);
const subscribers = useRef(new Set());

// When value changes, we notify subscribers manually
useEffect(() => {
  subscribers.current.forEach(callback => callback());
}, [value]);`})}),e.jsx("h4",{style:{marginTop:"var(--space-4)"},children:"2. The Selector Hook"}),e.jsx("pre",{style:{background:"transparent"},children:e.jsx("code",{children:`// Component subscribes ONLY to the result of the selector
useSyncExternalStore(
  subscribe, // Function to register a listener
  () => selector(storeRef.current) // Snapshots the slice of state
);

// React only re-renders if the *result* of selector(storeRef.current) changes!`})})]}),e.jsxs("section",{style:{marginBottom:"var(--space-8)"},children:[e.jsx("h2",{children:"Interactive Demo"}),e.jsxs("div",{style:{background:"var(--bg-secondary)",padding:"var(--space-6)",borderRadius:"var(--radius-lg)",marginTop:"var(--space-4)",border:"2px solid var(--color-success)"},children:[e.jsx("h3",{style:{marginBottom:"var(--space-4)",color:"var(--color-success)"},children:"Interactive Solution Demo"}),e.jsx(f,{})]})]}),e.jsxs("section",{style:{marginBottom:"var(--space-8)"},children:[e.jsx("h2",{children:"Context Selector Libraries"}),e.jsxs("div",{style:{background:"var(--color-info)",color:"white",padding:"var(--space-4)",borderRadius:"var(--radius-lg)",marginTop:"var(--space-4)"},children:[e.jsx("h3",{style:{color:"white",marginBottom:"var(--space-3)"},children:"üí° Popular Libraries:"}),e.jsxs("ul",{style:{paddingLeft:"var(--space-6)"},children:[e.jsxs("li",{style:{color:"white",marginBottom:"var(--space-2)"},children:[e.jsx("strong",{children:"use-context-selector"})," - Lightweight selector hook"]}),e.jsxs("li",{style:{color:"white",marginBottom:"var(--space-2)"},children:[e.jsx("strong",{children:"zustand"})," - Modern state management with selectors"]}),e.jsxs("li",{style:{color:"white",marginBottom:"var(--space-2)"},children:[e.jsx("strong",{children:"jotai"})," - Atomic state management"]}),e.jsxs("li",{style:{color:"white"},children:[e.jsx("strong",{children:"valtio"})," - Proxy-based state"]})]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{children:"Key Takeaways"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Context re-renders all consumers on any change"}),e.jsx("li",{children:"Selectors subscribe to specific parts of state"}),e.jsxs("li",{children:["Use ",e.jsx("code",{children:"useSyncExternalStore"})," for custom selectors"]}),e.jsx("li",{children:"Libraries like use-context-selector simplify this"}),e.jsx("li",{children:"Great for large context objects"}),e.jsx("li",{children:"Consider state management libraries for complex apps"})]})]})]})}const i=t.createContext(null);function m(){const[o,s]=t.useState({count:0,user:"John",theme:"light"});return e.jsx(i.Provider,{value:o,children:e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:"var(--space-2)",marginBottom:"var(--space-4)",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>s(r=>({...r,count:r.count+1})),style:{padding:"var(--space-2) var(--space-4)",background:"var(--color-error)",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Increment Count"}),e.jsx("button",{onClick:()=>s(r=>({...r,user:r.user==="John"?"Jane":"John"})),style:{padding:"var(--space-2) var(--space-4)",background:"var(--color-error)",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Toggle User"}),e.jsx("button",{onClick:()=>s(r=>({...r,theme:r.theme==="light"?"dark":"light"})),style:{padding:"var(--space-2) var(--space-4)",background:"var(--color-error)",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Toggle Theme"})]}),e.jsxs("div",{style:{display:"grid",gap:"var(--space-3)"},children:[e.jsx(g,{}),e.jsx(j,{}),e.jsx(y,{})]}),e.jsx("p",{style:{color:"var(--color-error)",fontSize:"var(--font-size-sm)",marginTop:"var(--space-4)"},children:"‚ö†Ô∏è Notice: Clicking ANY button re-renders ALL components below!"})]})})}function g(){const o=t.useContext(i);if(!o)throw new Error("Missing Provider");const s=t.useRef(0);return s.current+=1,e.jsxs("div",{style:{padding:"var(--space-3)",background:"var(--color-error-100)",borderRadius:"var(--radius-md)"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Count:"})," ",o.count]}),e.jsxs("p",{style:{fontSize:"var(--font-size-sm)",color:"var(--text-tertiary)"},children:["Renders: ",s.current]})]})}function j(){const o=t.useContext(i);if(!o)throw new Error("Missing Provider");const s=t.useRef(0);return s.current+=1,e.jsxs("div",{style:{padding:"var(--space-3)",background:"var(--color-error-100)",borderRadius:"var(--radius-md)"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"User:"})," ",o.user]}),e.jsxs("p",{style:{fontSize:"var(--font-size-sm)",color:"var(--text-tertiary)"},children:["Renders: ",s.current]})]})}function y(){const o=t.useContext(i);if(!o)throw new Error("Missing Provider");const s=t.useRef(0);return s.current+=1,e.jsxs("div",{style:{padding:"var(--space-3)",background:"var(--color-error-100)",borderRadius:"var(--radius-md)"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Theme:"})," ",o.theme]}),e.jsxs("p",{style:{fontSize:"var(--font-size-sm)",color:"var(--text-tertiary)"},children:["Renders: ",s.current]})]})}const{Provider:b,useSelector:d}=v();function f(){const[o,s]=t.useState({count:0,user:"John",theme:"light"});return e.jsx(b,{value:o,children:e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:"var(--space-2)",marginBottom:"var(--space-4)",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>s(r=>({...r,count:r.count+1})),style:{padding:"var(--space-2) var(--space-4)",background:"var(--color-primary-500)",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Increment Count"}),e.jsx("button",{onClick:()=>s(r=>({...r,user:r.user==="John"?"Jane":"John"})),style:{padding:"var(--space-2) var(--space-4)",background:"var(--color-accent-500)",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Toggle User"}),e.jsx("button",{onClick:()=>s(r=>({...r,theme:r.theme==="light"?"dark":"light"})),style:{padding:"var(--space-2) var(--space-4)",background:"var(--color-success)",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Toggle Theme"})]}),e.jsxs("div",{style:{display:"grid",gap:"var(--space-3)"},children:[e.jsx(S,{}),e.jsx(C,{}),e.jsx(w,{})]}),e.jsx("p",{style:{color:"var(--text-tertiary)",fontSize:"var(--font-size-sm)",marginTop:"var(--space-4)"},children:"Check console: Each component only re-renders when its selected value changes!"})]})})}const S=t.memo(function(){const s=d(n=>n.count),r=t.useRef(0);return r.current+=1,console.log("CountDisplay rendered"),e.jsxs("div",{style:{padding:"var(--space-3)",background:"var(--color-primary-100)",borderRadius:"var(--radius-md)"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Count:"})," ",s]}),e.jsxs("p",{style:{fontSize:"var(--font-size-sm)",color:"var(--text-tertiary)"},children:["Renders: ",r.current]})]})}),C=t.memo(function(){const s=d(n=>n.user),r=t.useRef(0);return r.current+=1,console.log("UserDisplay rendered"),e.jsxs("div",{style:{padding:"var(--space-3)",background:"var(--color-accent-100)",borderRadius:"var(--radius-md)"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"User:"})," ",s]}),e.jsxs("p",{style:{fontSize:"var(--font-size-sm)",color:"var(--text-tertiary)"},children:["Renders: ",r.current]})]})}),w=t.memo(function(){const s=d(n=>n.theme),r=t.useRef(0);return r.current+=1,console.log("ThemeDisplay rendered"),e.jsxs("div",{style:{padding:"var(--space-3)",background:"var(--color-success)",color:"white",borderRadius:"var(--radius-md)"},children:[e.jsxs("p",{style:{color:"white"},children:[e.jsx("strong",{children:"Theme:"})," ",s]}),e.jsxs("p",{style:{fontSize:"var(--font-size-sm)",color:"white"},children:["Renders: ",r.current]})]})});export{T as default};
//# sourceMappingURL=ContextSelectors-CoWS9bnk.js.map
